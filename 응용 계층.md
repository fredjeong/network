# 5. 응용 계층

## 5.1 DNS와 자원

### 도메인 네임과 네임 서버

- 네트워크 상의 호스트를 특정하기 위해서는 IP 주소를 사용
- 통신하고자 하는 모든 호스트의 IP 주소를 기억하기가 어렵고, 호스트의 IP 주소는 언제든지 바뀔 수 있음
- 따라서 일반적으로 상대 호스트를 특정하기 위해 IP 주소보다 **도메인 네임**을 더 많이 사용함
    - IP 주소와 대응되는 문자열 형태의 호스트 특정 정보
    - 도메인 네임과 그에 대응되는 IP 주소는 **네임 서버**에서 관리
    - 도메인 네임을 관리하는 네임 서버는 DNS 서버라고도 함
- 도메인 네임은 IP 주소에 비해 기억하기 쉬우며, IP 주소가 바뀌더라도 바뀐 IP 주소에 도메인 네임을 다시 적용하면 되므로 IP 주소만으로 호스트를 특정하는 것보다 간편함
- 도메인 네임 구조
    - 루트 도메인(root domain)
    - 최상위 도메인(TLD; Top-Level Domain)
        - 예시: com, kr, edu
    - 2단계 도메인(second level domain)
        - 예시: example, co, ac
    - 3단계 도메인(third level domain)
        - 예시: www
    - 일반적으로 3-5단계로서, 이들을 모두 포함하는 도메인 네임을 전체 주소 도메인 네임(FQDN; Fully-Qualified Domain Name)이라고 함
        - FQDN의 첫 번째 부분(www)을 호스트 네임이라고 부르기도 함
- 도메인 네임 시스템(DNS; Domain Name System)
    - 계층적이고 분산된 도메인 네임에 대한 관리 체계
    - 호스트가 이러한 도메인 네임 시스템을 이용할 수 있도록 하는 애플리케이션 계층 프로토콜을 의미하기도 함

### 계층적 네임 서버

- 리졸빙(resolving)
    - IP 주소를 모르는 상태에서 도메인 네임에 대응되는 IP 주소를 알아내는 과정
    - 다양한 네임 서버를 사용
- 네임 서버의 유형
    - 로컬 네임 서버(local name server)
        - 클라이언트와 맞닿아 있는 네임 서버로, 클라이언트가 도메인 네임을 통해 IP 주소를 알아내고자 할 때 가장 먼저 찾게 되는 ㅔㄴ임 서버
        - 일반적으로 ISP에서 할당해주지만, 공개 DNS 서버를 이용할 수도 있음
    - 루트 네임 서버(root name server)
        - 로컬 네임 서버가 도메인에 대응되는 IP 주소를 모를 때 루트 네임서버에게 해당 도메인 네임을 질의하게 됨
        - 루트 네임 서버는 루트 도메인을 관장하는 네임 서버로, 질의에 대해 TLD 네임 서버의 IP 주소를 반환함
        - TLD 네임 서버는 질의에 대해 TLD의 하위 도메인 네임을 관리하는 네임 서버 주소를 반환
        - 하위 도메인 네임을 관리하는 네임 서버는 마찬가지로 그보다 하위 도메인 네임을 관리하는 네임 서버 주소를 반환함
    - 책임 네임 서버(authoritative name server)
        - 특정 도메인 영역(zone)을 관리하는 네임 서버로, 자신이 관리하는 도메인 영역의 질의에 대해서는 곧바로 답할 수 있는 네임 서버
        - 로컬 네임 서버가 마지막으로 질의하는 네임 서버
- 리졸빙 과정
    - 재귀적 질의(recursive query)
        - 클라이언트가 로컬 네임 서버에게 도메인 네임을 질의하면, 로컬 네임 서버가 루트 네임 서버에게 질의하고, 루트 네임 서버가 TLD 네임 서버에게 질의하고, TLD 네임 서버가 다음 단계에 질의하는 과정을 반복하며 최종 응답 결과를 역순으로 전달받는 방식
    - 반복적 질의(iterative query)
        - 클라이언트가 로컬 네임 서버에게 IP 주소를 알고 싶은 도메인 네임을 질의하면, 로컬 네임 서버는 루트 도메인 서버에게 질의해서 다음으로 질의할 네임 서버의 주소를 응답받고, 다음으로 TLD 네임 서버에게 질의해서 다음으로 질의할 네임 서버의 주소를 응답받는 과정을 반복하다가 최종 응답 결과를 클라이언트에게 알려주는 방식
    - 이러한 방식으로는 질의응답에 시간이 오래 걸리고 네트워크 상의 메시지 수가 지나치게 늘어날 수 있음
    - 따라서 실제로는 네임 서버들이 기존에 응답받은 결과를 임시로 저장했다가 DNS 캐시(DNS cache) 방식으로 추후 같은 질의에 이를 활용함

### 자원을 식별하는 URI

- 자원(resource)
    - 네트워크 상의 메시지를 통해 주고받는 대상
    - 예시: HTML 파일, 이미지, 동영상 파일, 텍스트 파일
- URI (Uniform Resource Identifier)
    - 자원을 식별하는 통일된 방식의 정보

#### URL (Uniform Resource Locator)

- scheme
    - 자원에 접근하는 방법
    - 일반적으로 사용할 프로토콜 명시
    - 예시: http://, https://
- authority
    - 호스트를 특정할 수 있는 정보 명시
    - 콜론 뒤에 포트 번호를 덧붙일 수도 있음
    - 예시: IP 주소, 도메인 네임
- path
    - 자원이 위치한 경로 명시
- query
    - 쿼리 문자열(query string) 또는 쿼리 파라미터(query parameter)를 사용해 자원의 위치 식별
        - 물음표로 시작되는 <키=값> 형태의 데이터로, 앰퍼샌드(&)를 사용하여 여러 쿼리 문자여릉ㄹ 연결
    - 예시: http://example.com/random/path?query=value&query2=value2
- fragment
    - HTML 파일 자원 내의 특정 부분 표시

#### URN (Uniform Resource Name)

- 자원의 위치가 변경되면 기존 URL로는 자원을 식별할 수 없다는 문제가 있음
- URN은 자원에 고유한 이름을 붙이는 이름 기반 식별자이므로 자원의 위치와 무관하게 자원을 식별할 수 있음

## 5.2 HTTP

### HTTP의 특성

- HTTP (Hypertext Transfer Protocol)
    - 응용 계층에서 정보를 주고받는 데 사용되는 프로토콜

#### 요청-응답 기반 프로토콜

- 같은 HTTP 메시지라도 HTTP 요청 메시지와 HTTP 응답 메시지는 메시지 형태가 다름

#### 미디어 독립적 프로토콜

- HTTP는 자원의 특성을 제한하지 않으며, 단지 자원과 상호 작용하는 데 사용할 수 있는 인터페이스를 정의
- 대부분의 자원 식별은 URI로 이루어짐

#### 스테이트리스 프로토콜

- HTTP는 상태를 유지하지 않음
- 서버가 HTTP 요청을 보낸 클라이언트와 관련된 상태를 기억하지 않음
- 클라이언트가 실수로 특정 HTTP 요청 메시지를 서버에게 여러 번 전송할 때 서버는 이들을 각기 다른 요청으로 간주
- 확장성(scalability)와 견고성(robustness) 측면에서 스테이트리스 방식이 유리함

#### 지속 연결 프로토콜

- HTTP는 비연결형 프로토콜이지만, HTTP가 동작하는 TCP는 연결형 프로토콜임
- 비지속 연결
    - 초기 HTTP 버전은 쓰리 웨이 핸드셰이크를 통해 TCP 연결을 수립한 후, 요청에 대한 응답을 받으면 연결을 종료하는 방식으로 동작했음
    - 추가적인 요청-응답을 위해서는 다시 TCP 연결을 수립
- 지속 연결(persistent connection) 또는 킵 얼라이브(keep-alive)
    - 하나의 TCP 연결 상에서 여러 개의 요청-응답을 주고받을 수 있는 기술
    - 비지속 연결에 비해 더 빠르게 여러 HTTP 요청과 응답을 처리할 수 있음

### HTTP 메시지 구조

- 시작 라인(start-line)
    - 요청 라인(request-line)
        - HTTP 메시지가 HTTP 요청 메시지일 경우
        - 형식
            - 메서드(method)
                - 클라이언트가 서버의 자원(요청 대상)에 대해 수행할 작업의 종류
                - 예시: GET, POST, PUT, DELETE 등
            - 요청 대상(request-target)
                - HTTP 요청을 보낼 서버의 자원
                - 쿼리가 포함된 URI 경로 명시
            - HTTP 버전
    - 상태 라인(state-line)
        - HTTP 메시지가 HTTP 응답 메시지일 경우
        - 형식
            - HTTP 버전
            - 상태 코드(status code)
                - 요청에 대한 결과를 나타내는 세 자리 정수
            - 이유 구문(reason phrase)
                - 상태 코드에 대한 문자열 형태의 설명
- 필드 라인
    - 헤더 라인(header line)
        - 0개 이상의 HTTP 헤더(HTTP 통신에 필요한 부가 정보)가 명시됨
- 메시지 본문(message-body)

### HTTP 메서드

#### GET

- 특정 자원을 조회할 때 사용

#### HEAD

- GET 메서드와 동일한 역할을 하지만, 응답 메시지에 메시지 본문이 포함되지 않고 헤더만을 포함

#### POST

- 서버로 하여금 특정 작업을 처리하도록 요청
- 많은 경우 클라이언트가 서버에 새로운 자원을 생성하고자 할 때 사용됨

#### PUT

- 덮어쓰기를 요청하는 메서드
- 요청 자원이 없다면 메시지 본문으로 자원을 새롭게 생성
- 이미 자원이 존재한다면 메시지 본문으로 자원을 완전히 대체

#### PATCH

- 부분적 수정 요청

#### DELETE

- 특정 자원을 삭제할 때 사용

### HTTP 상태 코드

- 200번대: 성공 상태 코드
- 300번대: 리다이렉션 상태 코드
    - 요청을 완수하기 위해 추가적인 조치가 필요한 상태
- 400번대: 클라이언트 에러 상태 코드
- 500번대: 서버 에러 상태 코드

## 5.3 HTTP 헤더와 HTTP 기반 기술

### HTTP 헤더

#### 요청 시 활용되는 HTTP 헤더

- Host
    - 요청을 보낼 호스트를 나타내는 헤더
    - 주로 도메인 네임으로 명시되며, 포트 번호가 포함되어 있을 수 있음
- User-Agent
    - 웹 브라우저와 같이 HTTP 요청을 시작하는 클라이언트 측의 프로그램
    - 요청 메시지 생성에 관여한 클라이언트 프로그램과 관련된 정보 명시
- Referrer
    - 클라이언트가 요청을 보낼 때 머무르고 있던 URL 명시
    - Referrer를 통해 클라이언트의 유입 경로를 파악할 수 있음
- Authorisation
    - 클라이언트의 인증 정보를 담음
    - 인증 타입(type)과 인증을 위한 정보(credentials)가 차례로 명시됨

#### 응답 시 활용되는 HTTP 헤더

- Server
    - 요청을 처리하는 서버 측의 소프트웨어와 관련된 정보를 명시
- Allow
    - 클라이언트에게 허용된 HTTP 메서드 목록을 알려주기 위해서 사용
- Retry-After
    - 503 상태 코드(Service Unavailable) 응답과 함께 사용되어 자원을 사용할 수 있는 날짜 혹은 시간을 알려줌
- Location
    - 리다이렉션이 발생했을 때나 새로운 자원이 생성되었을 때, 클라이언트에게 자원의 위치를 알려주기 위해 사용
- WWW-Authenticate
    - 상태 코드 401(Unauthorized)와 함께 사용되며, 자원에 접근하기 위한 인증 방식을 설명

#### 요청과 응답 모두에서 활용되는 HTTP 헤더

- Date
- Connection
    - 클라이언트의 요청과 응답 간의 연결 방식을 설정
    - 예시: keep-alive, close
- Content-Length
- Content-Type, Content-Language, Content-Encoding

### 캐시(cache)

- 불필요한 대역폭 낭비와 응답 지연을 방지하기 위해 정보의 사본을 임시로 저장하는 기술
- 동일한 요청에 대해 캐시된 데이터를 활용할 수 있기 때문에 불필요한 대역폭 낭비를 줄이고, 더 빠르게 데이터에 접근할 수 있음

### 쿠키(cookie)

- 서버에서 생성되어 클라이언트 측에 저장되는 데이터
- 상태를 유지하지 않는 HTTP의 특성을 보완
- 서버는 쿠키를 생성하여 클라이언트에게 전송하고, 클라이언트는 전달받은 쿠키를 저장해 두었다가 추후 동일한 서버에 보내는 요청 메시지에 쿠키를 포함하여 전송

### 콘텐츠 협상과 표현

- 콘텐츠 협상(content negotiation)
    - 같은 URI에 대해 가장 적합한 자원의 형태를 제공하는 매커니즘
    - 예시: 같은 URI로 식별 가능한 HTML 문서라 해도, 영어로 요청하면 영어로 된 형태로 제공하고, 한국어로 요청하면 한국어로 된 형태를 제공하는 것
- 표현(representation)
    - 송수신 가능한 자원의 형태

